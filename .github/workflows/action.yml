name: 'build-src and doc'
description: 'Build src of libcimpp'
inputs:
  use_cim_version:  # id of input    
    required: true
    default: 'IEC61970_16v29a'
  input_dir: 
    required: true
    default: '~'
  build_type: 
    required: true
    default: 'src'
runs: 
  using: "composite"
  steps:
      - run: cd ${{inputs.input_dir}}
        shell: bash
      - run: cmake -E make_directory ${{inputs.input_dir}}/build/${{inputs.use_cim_version}}
        shell: bash
      - run: cd build/${{inputs.use_cim_version }} #cd ${{inputs.input_dir}}/build/${{inputs.use_cim_version }}
        shell: bash
      - run: cmake ${{inputs.input_dir}} -DUSE_CIM_VERSION=${{inputs.use_cim_version }}
        shell: bash
      
        run: ${{contains( ${{inputs.build_type}} , 'src')}} && make -j8
        shell: bash

      - name: 'build-doc'
        run: ${{contains( ${{inputs.build_type}} , 'doc')}} && make doc
        shell: bash
        uses: ${{contains( ${{inputs.build_type}} , 'doc')}} && actions/upload-artifact@v2
        with:
          name: doc
          path: ${{inputs.input_dir}}/build/${{inputs.use_cim_version}}/doc/html
          retention-days: 90


